qing.registNS("qcmt");qcmt.cmtRequestMgr=(function(){var c={cmtList:qDomain.qing+"/qcmt/data/cmtlist",cmtAdd:qDomain.qing+"/qcmt/submit/createcmt",cmtDelete:qDomain.qing+"/qcmt/submit/deletecmt",repostAdd:qDomain.qing+"/pub/submit/createrepost"};function e(i){var g=[];for(var h in i){if(typeof h=="undefined"){g.push(h)}}if(g.length){return new Error("Parameter Undefine Error: "+g.join("  "))}}function a(g,h){var i=g.thread_id_enc;var j=g.count;e({thread_id_enc:i,count:j});var k={thread_id_enc:i,start:g.start||0,count:g.count,orderby_type:(typeof g.orderby_type=="undefined")?1:g.orderby_type,favor:typeof g.favor=="undefined"?2:g.favor,type:"smblog"};qing.ajax.request(c.cmtList,{data:k,noCache:true,onsuccess:h.onsuccess,onerror:h.onerror,onfailure:h.onfailure,onexception:h.onexception,ontimeout:h.ontimeout})}function d(k,g){if(qVisitorInfo.loginStatus=="not_login"){qui.showLogin();return}else{if(qVisitorInfo.loginStatus!="activated"){qui.showActive();return}}var h=k.thread_id_enc;var i=k.content;e({thread_id_enc:h,content:i});var j={thread_id_enc:h,parent_id_enc:k.parent_id_enc||0,content:i,mms_flag:k.mms_flag||0,replyee_portrait:k.replyee_portrait,host_portrait:k.host_portrait,type:"smblog"};qing.ajax.request(c.cmtAdd,{method:"post",data:j,onsuccess:g.onsuccess,onerror:g.onerror,onfailure:g.onfailure,onexception:g.onexception,ontimeout:g.ontimeout})}function b(i,g){if(qVisitorInfo.loginStatus=="not_login"){qui.showLogin();return}else{if(qVisitorInfo.loginStatus!="activated"){qui.showActive();return}}var h=i.thread_id_enc;var j=i.reply_id_enc;e({thread_id_enc:h,reply_id_enc:j});qing.ajax.request(c.cmtDelete,{method:"post",data:{thread_id_enc:h,reply_id_enc:j,type:"smblog"},onsuccess:g.onsuccess,onerror:g.onerror,onfailure:g.onfailure,onexception:g.onexception,ontimeout:g.ontimeout})}function f(j,g){if(qVisitorInfo.loginStatus=="not_login"){qui.showLogin();return}else{if(qVisitorInfo.loginStatus=="not_activate"){qui.showActive();return}}var h=j.thread_id_enc;var i=j.reason;e({thread_id_enc:h,reason:i});qing.ajax.request(c.repostAdd,{method:"post",data:j,onsuccess:g.onsuccess,onerror:g.onerror,onfailure:g.onfailure,onexception:g.onexception,ontimeout:g.ontimeout})}return{cmtList:a,cmtAdd:d,cmtDelete:b,repostAdd:f}})();qing.registNS("qcmt");qcmt.tpl=(function(){var m=['<div id="#{cmtWraperId}" class="qcmt-wraper-box-comment #{qcmtAddTagWrapper}">','<div class="cmt-border-top"></div>','<div class="qcmt-arrow-wraper" style="left:#{arrowLeft}px;">','<div class="qcmt-arrow-border"></div>','<div class="qcmt-arrow-shadow"></div>','<div class="qcmt-arrow"></div>','<div class="qcmt-arrow-inner"></div>',"</div>",'<div class="qcmt-input-box clearfix">','<div class="qcmt-input-textarea-box">','<div class="qcmt-textarea-wraper">','<div class="qcmt-textarea-minishadow clearfix">','<div class="qcmt-tag-box"></div>','<textarea class="qcmt-textarea-box"></textarea>',"</div>","</div>",'<div class="qcmt-input-repost-checkbox left">','<div class="qcmt-reply-friend hide">','<input type="checkbox" name="comment" class="qcmt-reply-friend-check" id="repostCheckFriend#{checkIndex}" checked />&nbsp;','<label for="repostCheckFriend#{checkIndex}">同时评论给&nbsp; #{friendName}</label>',"</div>",'<div class="qcmt-reply-author hide">','<input type="checkbox" name="comment" class="qcmt-reply-author-check" id="repostCheckAuthor#{checkIndex}" checked />&nbsp;','<label for="repostCheckAuthor#{checkIndex}">同时评论给原文作者&nbsp; #{authorName}</label>',"</div>","</div>","</div>",'<div class="qcmt-sub-bt-box">','<a href="#" class="cmt-add button button-save button-cmt clearfix"><span class="button-left">&#160;</span><span class="button-text">发布</span><span class="button-right">&#160;</span></a>','<div class="qcmt-input-textnum-tip right hide">','<span class="num-box num-total">500</span>','<span class="num-box num-l">/</span>','<span class="num-box now-num">0</span>',"</div>","</div>","</div>",'<div class="qcmt-main-wraper">','<div class="qcmt-main-box">#{cmtListContent}','<div class="qcmt-list-wraper">#{cmtListContent}</div>','<div class="qcmt-footer-wraper">#{footer}</div>',"</div>","</div>","</div>"].join("");var b=['<div class="qcmt-footer-box clearfix">','<a class="qcmt-collapse" href="#">','<span class="collapse-arrow"></span>','<span class="collapse-tip cs-contentblock-link">收起</span>',"</a>",'<span class="qcmt-vl #{isSeemoreHideClass}">|</span>','<a class="cmt-seemore cmt-seenext #{isSeemoreHideClass}" href="#{seemoreUrl}" target="_blank">','<span class="seemore-arrow hide"></span>','<span class="seemore-tip cs-contentblock-link">查看更多</span>',"</a>",'<span class="seemore-loading hide"></span>',"</div>"].join("");var k='<div class="cmt-list">#{cmtList}</div>';var d='<a href="#" class="cmt-report hide cs-contentblock-link" onclick="return false">举报</a>';var j='<a href="#" class="cmt-delete #{isHoverShowClass} cs-contentblock-link">删除</a>';var f='<a href="#" class="cmt-reply #{isReplyHideClass} cs-contentblock-link">回复</a>';var i=['<div class="cmt-content-box">','<div class="cmt-content-detail">#{cmtDetailTpl}</div>','<div class="cmt-pub-time">#{cmtPubTime}</div>','<div class="cmt-control-box">',"#{controlBoxTpl}","</div>","</div>"].join("");var e=['<div class="cmt-item"  data-cmt-id="#{cmtId}" id="#{cmtId}">','<div class="cmt-item-content clearfix">',i,"</div>",'<div class="cmt-mini-border"></div>',"</div>"].join("");var a=['<a class="cmt-item-portrait" href="#{userUrl}" title="#{userName}" data-user-id="#{userId}" target="_blank">','<img alt="#{userName}" src="#{imgUrl}"/>',"</a>",'<a class="cmt-user-name cs-contentblock-link" href="#{userUrl}" target="_blank">',"#{userName}","</a>","#{summary}",'<span class="wise-ico #{isWiseIcoShowClass}" title="来自空间手机版">&nbsp;</span>'].join("");var h=['<div class="cmt-actor-info clearfix">','<a class="cmt-item-portrait" href="#{userUrl}" title="#{userName}" data-user-id="#{userId}" target="_blank">','<img alt="#{userName}" src="#{imgUrl}"/>',"</a>",'<a class="cmt-replyer-name cs-contentblock-link" href="#{userUrl}" title="#{userName}" target="_blank">#{userName}</a><span class="cmt-reply-tip">回复</span><a href="#{replyeeUrl}" title="#{replyeeName}" class="cmt-replyee-name cs-contentblock-link" target="_blank">#{replyeeName}</a>',"</div>",'<div class="cmt-summary">#{summary}<span class="wise-ico #{isWiseIcoShowClass}" title="来自空间手机版">&nbsp;</span></div>'].join("");var g=['<div class="cmt-list #{tagWrap}"><div class="cmt-item">','<div class="cmt-tag-list clearfix"><span class="cmt-tag-text">常用标签：</span>#{tagLists}</div>','<div class="cmt-mini-border"></div></div></div>','<div class="cmt-list #{hotTagWrap}"><div class="cmt-item">','<div class="cmt-tag-list clearfix"><span class="cmt-tag-text">热门标签：</span>#{hotTagLists}</div>',"</div></div>"].join("");var l=['<a class="cmt-tag-item">#{tagName}</a>'].join("");var c=['<span title="#{tagName}" class="qcmt-inner-tag-name">#{tagName}</span>','<a title="删除" class="qcmt-inner-tag-close" href="#">×</a>'].join("");return{wraper:m,cmtList:k,cmtItemInner:i,cmtItem:e,cmtDetailTpl:a,cmtReplyDetailTpl:h,cmtFooter:b,cmtDeleteTpl:j,cmtReportTpl:d,cmtReplyTpl:f,cmtAddTagTpl:g,cmtTagItemTpl:l,innerTag:c}})();qing.registNS("qcmt");qcmt.Base=qing.lang.createClass(function(b,c,a){this.elem=b;this.target=c.target;this.numElem=c.numElem;this.extraNumElem=c.extraNumElem;this.threadId=c.threadId;this.userInfo=c.userInfo;this.actorPortrait=c.actorPortrait;this.actorName=c.actorName;this.actorQingUrl=c.actorQingUrl;this.cmtWraperId=c.cmtWraperId;this.focus=c.focus;this.bindTargetEvent=c.bindTargetEvent;this.callback=c.callback;this.engineListenObj={};this.contentType=c.contentType;this.originAuthor=c.originAuthor;this.originThreadId=c.originThreadId;this.repostSuccess=c.repostSuccess;this.destroyCallback=c.destroyCallback},{}).extend({format:function(){},engineListen:function(){var a=this;qing.array.each(["click","mouseover","mouseout","keyup","focus","blur","paste","cut","input","keydown"],function(e){qing.on(a.cmtWraperId,e,function(g){var f=g.target||g.srcElement;if(!f){return false}for(var i in a.engineListenObj[e]){var h=a.engineListenObj[e][i];if((f.className&&qing.dom.hasClass(f,i))){h.apply(f,[g,a]);break}else{if(ancestor=qext.fn.getAncestorByClass(f,i)){h.apply(ancestor,[g,a]);break}}}});if(e=="focus"||e=="blur"){for(var d in a.engineListenObj[e]){var b=qing.dom.q(d,qing.g(a.cmtWraperId));if(!b){return false}var c=a.engineListenObj[e][d];qing.array.each(b,function(g,f){qing.event.on(g,e,function(h){c.apply(g,[h,a])})})}}})}});qing.registNS("qcmt");qcmt.Repost=(function(){var b=function(j){var m=200,k=2,i=k*2+1;var l=function(){i--;if(i%2==0){qing.dom.addClass(j,"input-box-warning")}else{qing.dom.removeClass(j,"input-box-warning")}if(i<1){qing.dom.removeClass(j,"input-box-warning");return}setTimeout(l,m)};l()};var d=function(o,j){qing.event.preventDefault(o);if(j.elem.cmtCreating||j.elem.cmtCrashing){return}var n=qing.dom.query(".qcmt-textarea-box",j.elem)[0];var m=n.value;var k=m;if(m.length==0){}if(qing.string.getByteLength(m)>280){qui.showAlert("转载理由字数过多");return}var l=qing.dom.query(".qcmt-reply-friend-check",j.elem)[0];var i=qing.dom.query(".qcmt-reply-author-check",j.elem)[0];var p;if(j.contentType=="repost"){p=l.checked||i.checked}else{p=l.checked}if(p&&m.length==0){b(n);return}j.elem.cmtCrashing=true;qcmt.cmtRequestMgr.repostAdd({thread_id_enc:j.threadId,reason:m},{onfailure:function(){if(j&&j.elem){j.elem.cmtCrashing=false}},onerror:function(q){if(j&&j.elem){j.elem.cmtCrashing=false}if(parseInt(q.errorNo,10)==102||parseInt(q.errorNo,10)==600){return}qui.showError(q.errorMsg)},onsuccess:function(){qui.showSuccess("转载成功");n.value="";n.focus();if(j.numElem){var r=/(\d+)/.exec(j.numElem.innerHTML);var w=qing.dom.getAttr(j.numElem,"data-prefix"),s=qing.dom.getAttr(j.numElem,"data-suffix");if(w===null){w="("}if(s===null){s=")"}if(r&&r[1]){j.numElem.innerHTML=w+(parseInt(r[1])+1)+s}else{j.numElem.innerHTML=w+"1"+s}qing.dom.hasClass(j.numElem,"hide")&&qing.dom.removeClass(j.numElem,"hide");j.numElem.style.display=""}j.elem.style.overflow="hidden";var q=qani.animate(j.elem,{height:j.elem.offsetHeight+"px$tween:strongAccelerate"},{height:0},300);q.on("finish",function(){j.elem.style.display="none";j.elem.style.overflow="visible";j.elem.style.height="0";j.elem.cmtCrashing=false;j.destroyCallback&&j.destroyCallback()});var t=document.createElement("script");t.type="text/javascript";t.src="http://tongji.hi.baidu.com/common/js/base_widget.js?v=51741037.js?v="+(new Date()).getTime();j.elem.appendChild(t);j.elem.targetElem=null;var v=qing.dom.query(".qcmt-reply-friend-check",j.elem)[0];var u=qing.dom.query(".qcmt-reply-author-check",j.elem)[0];if(v.checked){qcmt.cmtRequestMgr.cmtAdd({thread_id_enc:j.threadId,content:k,host_portrait:j.actorPortrait},{onsuccess:function(z){if(j.extraNumElem){var x=/(\d+)/.exec(j.extraNumElem.innerHTML);var A=qing.dom.getAttr(j.numElem,"data-prefix"),y=qing.dom.getAttr(j.numElem,"data-suffix");if(A===null){A="("}if(y===null){y=")"}if(x&&x[1]){j.extraNumElem.innerHTML=A+(parseInt(x[1])+1)+y}else{j.extraNumElem.innerHTML=A+"1"+y}qing.dom.hasClass(j.extraNumElem,"hide")&&qing.dom.removeClass(j.extraNumElem,"hide");j.extraNumElem.style.display=""}j.repostSuccess&&j.repostSuccess(z,j,k)}})}if(u.checked&&j.originAuthor&&j.originThreadId){qcmt.cmtRequestMgr.cmtAdd({thread_id_enc:j.originThreadId,content:k,host_portrait:j.originAuthor.portrait},{onsuccess:function(x){}})}}})};var e=function(k,i){var j=k.which||k.keyCode;if(k.ctrlKey&&j==13){d.call(this,k,i)}};var h=function(j,i){var k=qing.dom.query(".qcmt-textarea-wraper",i.elem)[0];qing.dom.addClass(k,"focus")};var g=function(j,i){var k=qing.dom.query(".qcmt-textarea-wraper",i.elem)[0];qing.dom.removeClass(k,"focus")};var c=function(j,i){qing.dom.addClass(this,"mouseover")};var a=function(j,i){qing.dom.removeClass(this,"mouseover")};var f={click:{"cmt-add":d},keyup:{"qcmt-textarea-box":e},mouseover:{"qcmt-textarea-wraper":c},mouseout:{"qcmt-textarea-wraper":a},focus:{"qcmt-textarea-box":h},blur:{"qcmt-textarea-box":g}};return qing.lang.createClass(function(){this.engineListenObj=f},{superClass:qcmt.Base}).extend({format:function(){var v=this;var t=v.actorName||"";var r="";if(v.originAuthor){r=v.originAuthor.name}var o=qing.string.format(qcmt.tpl.wraper,{cmtWraperId:v.cmtWraperId,arrowLeft:qing.dom.getPosition(v.target).left-qing.dom.getPosition(v.elem).left+5,cmtListContent:"",footer:"",friendName:t,authorName:r,checkIndex:qing.lang.guid()});v.elem.style.overflow="hidden";v.elem.style.height=v.elem.offsetHeight+"px";v.elem.innerHTML=o;var i=qing.g(v.cmtWraperId);var p=qani.animate(v.elem,{height:i.offsetHeight},300);p.on("finish",function(){v.elem.style.overflow="visible";v.elem.style.height="auto";var w=qing.dom.query(".qcmt-textarea-box",v.elem)[0];if(v.focus){w.focus()}v.callback&&v.callback();v.elem.cmtCreating=false});var n=qing.dom.query(".qcmt-textarea-box",v.elem)[0];var q=qing.dom.query(".qcmt-input-textnum-tip",v.elem)[0];q.style.display="block";var k=qing.dom.query(".now-num",q)[0];var m=qing.dom.query(".num-total",q)[0];m.innerHTML="140";qext.textarea({autoHeight:true,element:n,autoRender:true,gbkMaxSize:140,callback:function(x){var w=Math.ceil(x/2);k.innerHTML=w;k.style.color=w>=140?"#F46E6E":"#999"}});var u=qing.dom.query(".qcmt-reply-friend",v.elem)[0];var s=qing.dom.query(".qcmt-reply-author",v.elem)[0];qing.dom.removeClass(u,"hide");if(v.contentType=="repost"&&v.originAuthor&&v.originAuthor.name!=qVisitorInfo.userName&&v.originAuthor.name!=v.actorName){qing.dom.removeClass(s,"hide")}var j=document.createElement("div");qing.dom.setAttr(j,"id","anttongji");v.elem.appendChild(j);var l=document.createElement("script");l.type="text/javascript";l.src="http://tongji.hi.baidu.com/common/js/base_widget.js?v=51741037.js?v="+(new Date()).getTime();v.elem.appendChild(l)}})})();qing.registNS("qcmt");qcmt.Face=(function(){var d="http://img.baidu.com/hi/";var b={"精选":{folder:"jx2",prefix:"j_00",background:"qing/face/preview/jxFace.gif",face:{"兔斯基":["亲亲","love","哦耶","恐怖","扭屁股","强顶","抖胸","88","汗","瞌睡","鲁拉","拍砖","揉脸","生日快乐"],"绿豆蛙":["掩嘴笑","瀑布汗~","吃惊","臭美","傻笑","抛媚眼","发怒","打酱油","俯卧撑","气愤","颤抖","吻","怒","胜利"],BOBO:["hi","啵一个","不说","不要","寂寞","花心","我顶","大惊","飞吻","鬼脸","娇羞","口水","大哭","勾引"],"baby猫":["发财了","吃西瓜","套牢","小女人","庆祝","我来也","敲打","好多金子","O液","美美","被打","贪吃","迎接","得瑟"],"泡泡":["微笑","大笑","嘻嘻","紧张","酷","生气","阴险","一滴汗","哭","憨憨的","鄙视","好困","牛","晕了"],"有啊":["开心","偷笑","痛哭","滴汗","叹气","超赞","囧","献吻","可怜","撒花","怒火","砸扁","吓傻","吐"]}},"兔斯基":{folder:"tsj",prefix:"t_00",background:"qing/face/preview/tFace.gif",face:["亲亲","love","哦耶","恐怖","扭屁股","强顶","抖胸","88","汗","瞌睡","鲁拉","拍砖","揉脸","生日快乐","摊手","睡觉","瘫坐","无聊","星星闪","旋转","没门儿","郁闷","high","抓墙","撞墙","疑问","戳眼","飘过","互相拍砖","砍死你","扔桌子","跳舞","什么？","转头","我爱牛奶","我踢","摇晃","晕厥","在笼子里","震荡"]},"绿豆蛙":{folder:"ldw",prefix:"w_00",background:"qing/face/preview/wFace.gif",face:["掩嘴笑","瀑布汗~","吃惊","臭美","傻笑","抛媚眼","发怒","我错了","money","气愤","挑逗","吻","怒","胜利","太委屈","受伤","白眼","闭嘴","不","逗你玩儿","姆啊","眩晕","魔法","我来了","睡了","我打","shut up","连环拳","打晕了","刷牙","爆炸","炸弹","倒立","刮胡子","邪恶的笑","使小性子","爱恋中","放大镜","偷窥","超高兴","晕","松口气","我跑","享受","装 13","掉泪","冷汗","惊恐","热烈欢迎","打酱油","俯卧撑","颤抖"]},BOBO:{folder:"bobo",prefix:"B_00",background:"qing/face/preview/bFace.gif",face:["hi","啵一个","不说","不要","寂寞","花心","我顶","大惊","飞吻","鬼脸","娇羞","口水","大哭","勾引","舍不得","难过","哼","吐舌","喜欢","转圈","再见","抓狂","我去!","切","膜拜","吐血","嘘","揍你","跳跳","变脸","扯肉","吃 to","吃花","吹泡泡","变身","飞天舞","回眸","凄惨","猛抽","泡泡","花痴","亲你","撒娇","骚舞","烧香","大睡","套娃娃","挨批评","街舞","西红柿","爱慕","折磨","摇摆","杂耍","招财","挨打","被球闷","霹雳","理想","欧打","呕吐","碎","吐痰"]},"baby猫":{folder:"babycat",prefix:"C_00",background:"qing/face/preview/cFace.gif",face:["发财了","吃西瓜","套牢","小女人","庆祝","我来也","敲打","好多金子","O液","美美","被打","贪吃","迎接","得瑟","UP顶","幸运","爱心","登场","送花","选择"]},"泡泡":{folder:"face",prefix:"i_f",background:"qing/face/preview/fFace.gif",face:["微笑","大笑","嘻嘻","紧张","酷","生气","阴险","一滴汗","哭","憨憨的","鄙视","好困","牛","晕了","不懂","尴尬","吐","害羞","委屈","亲","谄笑","爱情","心碎","玫瑰","礼物","哈哈笑","得意","可爱","色","眨眼","狂汗","楚楚可怜","困","害怕","威武","惊讶","喷","彩虹","月亮","太阳","金币","灯泡","咖啡","蛋糕","音乐","爱你","Victory","顶","踩","OK","气球"]},"有啊":{folder:"youa",prefix:"y_00",background:"qing/face/preview/yFace.gif",face:["男兜","女兜","开心","乖乖","偷笑","咔咔","抽泣","痛哭","无奈","滴汗","叹气","狂晕","好委屈","超赞","囧","不明白","献吻","可怜","撒花","怒火","砸扁","淫荡","泪奔","吓傻","吐舌头","点头","吐","转体","打呼","BS你","狂顶","篮球","拜拜","欢迎光临","恭喜发财","稍等","我在线","恕不议价","库房有货","货在路上"]}};var c={entrance:undefined,element:qing.dom.create("div",{"class":"qcmt-face-dialog"}),tpl:{img:'<img class="#{class}" src="#{src}" alt="#{alt}" title="#{title}" />',container:['<div class="qcmt-face-entrance-opened"></div>','<div class="qcmt-face-dialog-container">','<div class="qcmt-face-dialog-tab">',"#{tab}","</div>",'<div class="qcmt-face-dialog-icon">','<div class="qcmt-face-dialog-icon-preview clearfix" style="display: none;"></div>','<ul class="qcmt-face-dialog-icon-ul clearfix">',"#{icon}","</ul>","</div>","</div>"].join(""),icon:['<li class="qcmt-face-dialog-icon-li">','<span class="qcmt-face-dialog-icon-lispan" title="#{title}" data-gif="#{gif}" data-text="#{text}" style="background-image:url(#{bg}); background-position: left #{position}px;">',"</span>","</li>"].join(""),getTabBar:function(i){var k="",h={};for(var g in b){h[g]={"class":"qcmt-face-dialog-tab-li",selected:(g==i)?true:false}}return qui.tab.getHTML(h)},getIcons:function(h){var u=b[h],y=u.face,z="",t=this,w=0,m=25;if(qing.lang.isArray(y)){for(var s=0,n=y.length;s<n;s++){z+=qing.string.format(t.icon,{bg:[d,"/",u.background].join(""),position:w,title:y[s],gif:[u.folder,"/",u.prefix,qing.number.pad(s+1,2),".gif"].join(""),text:["[",h,":",y[s],"]"].join("")});w-=m}}else{if(qing.lang.isObject(y)){for(var o in y){for(var q=0,r=y[o].length;q<r;q++){var x=y[o][q];var g=qing.array.indexOf(b[o].face,x);z+=qing.string.format(t.icon,{bg:[d,"/",u.background].join(""),position:w,title:x,gif:[b[o].folder,"/",b[o].prefix,qing.number.pad(g+1,2),".gif"].join(""),text:["[",o,":",x,"]"].join("")});w-=m}}}}return z},format:function(l){var m=this,h="";if(!l){for(var k in b){l=k;break}}var g=m.getTabBar(l),j=m.getIcons(l);h=qing.string.format(m.container,{tab:g,icon:j});return h}},event:{init:function(){var g=this;g.ie.init()},ie:{init:function(){var g=this;g.inputRange=g.hoverRange},entranceHover:function(h){var g=this;if(document.selection){var i=document.selection.createRange().duplicate();g.hoverRange=i}}},insertFace:function(k,h){var i=this;if("selectionStart" in k){if(i._insertFace){return i._insertFace(k,h)}i._insertFace=function(n,m){var p=n.selectionStart,l=n.selectionEnd,o=n.value;n.value=[o.substr(0,p),m,o.substr(l,o.length)].join("");n.selectionStart+=m.length;n.selectionEnd=n.selectionStart;n.focus()};i._insertFace(k,h)}else{if(document.selection){var j=i.ie.inputRange;if(j&&j.parentElement()==k){j.text=h}else{k.value=[k.value,h].join("")}if(k.createTextRange){var g=k.createTextRange();g.moveStart("character",k.value.length);g.collapse();g.select()}k.focus&&k.focus()}}},click:function(g){var i=g.target||g.srcElement;if(qing.dom.hasClass(i,"qcmt-face-dialog-icon-lispan")){var k=qing.dom.getAncestorByClass(c.entrance,"qcmt-input-box");var h=qing.q("qcmt-textarea-box",k)[0];if(h){c.event.insertFace(h,qing.dom.getAttr(i,"data-text"))}}else{if(qing.dom.hasClass(i,"qcmt-face-dialog-tab-li")){var j=i.innerHTML;c.selectTab(j);qing.event.stop(g)}else{if(qing.dom.hasClass(i,"qcmt-face-entrance-opened")){}else{var l=qing.dom.getAncestorByClass(i,"qcmt-face-dialog");if(l){qing.event.stop(g)}}}}},clock:{hidePreviewer:undefined,resize:undefined},mouseout:function(i){var j=i.target||i.srcElement;if(qing.dom.hasClass(j,"qcmt-face-dialog-icon-lispan")){if(qing.browser.ie==6){var h=qing.dom.getAncestorByClass(j,"qcmt-face-dialog-icon-li");if(h){qing.dom.removeClass(h,"qcmt-face-dialog-icon-lihover")}}c.event.clock.hidePreviewer=setTimeout(function(){var l=qing.q("qcmt-face-dialog-icon-preview",qing.dom.getAncestorByClass(j,"qcmt-face-dialog-icon"))[0];qing.dom.hide(l)},80)}var g;if(qing.dom.hasClass(j,"tab-li")){g=j}else{var k=qing.dom.getAncestorByClass(j,"tab-li");if(k){g=k}}if(g&&qing.dom.hasClass(g,"tab-li-hover")){qing.dom.removeClass(g,"tab-li-hover")}},mouseover:function(i){var k=i.target||i.srcElement;if(qing.dom.hasClass(k,"qcmt-face-dialog-icon-lispan")){if(qing.browser.ie==6){var h=qing.dom.getAncestorByClass(k,"qcmt-face-dialog-icon-li");if(h){qing.dom.addClass(h,"qcmt-face-dialog-icon-lihover")}}clearTimeout(c.event.clock.hidePreviewer);var j=[d,qing.dom.getAttr(k,"data-gif")].join("");j=qing.string.format(c.tpl.img,{src:j});var n=qing.q("qcmt-face-dialog-icon-preview",qing.dom.getAncestorByClass(k,"qcmt-face-dialog-icon"))[0];n.innerHTML=j;var m=2*(i.clientX-qing.dom.getPosition(c.element).left);if(parseInt(m,10)>c.element.offsetWidth){qing.dom.setStyles(n,{right:"auto",left:0})}else{qing.dom.setStyles(n,{right:0,left:"auto"})}qing.dom.show(n)}var g;if(qing.dom.hasClass(k,"tab-li")){g=k}else{var l=qing.dom.getAncestorByClass(k,"tab-li");if(l){g=l}}if(g&&!qing.dom.hasClass(g,"tab-li-hover")&&!qing.dom.hasClass(g,"tab-li-selected")){qing.dom.addClass(g,"tab-li-hover")}},resize:function(g){clearTimeout(c.event.clock.resize);c.event.clock.resize=setTimeout(function(){qing.dom.setStyles(c.element,{left:qing.dom.getPosition(c.entrance).left,top:qing.dom.getPosition(c.entrance).top+c.entrance.offsetHeight})},10)},bind:function(){var h=this;var g=c.element;qing.on(g,"click",h.click);qing.on(g,"mouseover",h.mouseover);qing.on(g,"mouseout",h.mouseout);qing.on(window,"resize",h.resize)},unbind:function(){var h=this;var g=c.element;qing.un(g,"click",h.click);qing.un(g,"mouseout",h.mouseout);qing.un(window,"resize",h.resize)}},selectTab:function(g){var h=this;g=g||"";h.element.innerHTML=h.tpl.format(g)},show:function(g,h){qing.event.fire(document,"click");var i=this;i.entrance=g;h=h||{};qing.dom.setStyles(i.element,{position:h.position||"absolute","z-index":h.zIndex||500,left:h.left||qing.dom.getPosition(i.entrance).left,top:h.top||qing.dom.getPosition(i.entrance).top+i.entrance.offsetHeight});i.selectTab();document.body.appendChild(i.element);i.event.init();i.event.bind();setTimeout(function(){qing.event.once(document,"click",function(){i.remove()})},100)},remove:function(){var g=this;g.event.unbind();qing.dom.remove(g.element)}};var f=function(h){var g=h;var k=[];for(var j in b){k.push(j)}var m=["\\[(",k.join("|"),")\\:([^\\[\\]]+)\\]"].join("");var l=new RegExp(m,"g");g=h.replace(l,function(n,i,q){if(b[i]&&b[i].face){var p=qing.array.indexOf(b[i].face,q);if(p!=-1){var o="face-icon";p=p+1;n=qing.string.format(c.tpl.img,{src:[d,b[i].folder,"/",b[i].prefix,qing.number.pad(p,2),".gif"].join(""),alt:q,title:q,"class":o})}}return n});return g};var e=function(h,g){if(!h){return}g=g||{};var i=qing.dom.create("div",{"class":"qcmt-face-entrance"});qing.dom.insertAfter(i,h);qing.on(i,"click",function(j){c.show(this,g)});if(qing.browser.ie){qing.on(i,"mouseover",function(){c.event.ie.entranceHover(this)})}};var a={init:e,parse:f};return a})();qing.registNS("qcmt");qcmt.Comment=(function(){var g=function(D,A){qing.event.preventDefault(D);var G=this;var x=A.elem;var z=qext.fn.getAncestorByClass(G,"cmt-item");var B=qing.dom.query(".cmt-item-portrait",z)[0];var F=qing.dom.query("img",B)[0];var y=qing.dom.query(".qcmt-textarea-box",x)[0];var w=qing.dom.getPosition(x).top-70;var t=T.browser.isWebkit?document.body:document.documentElement;var v=t.scrollTop;if(v>w){var C=w<0?0:w;t.scrollTop=C}var u=qing.dom.getAttr(B,"title");y.value="回复 "+u+"：";A.toReplyeeId=qing.dom.getAttr(B,"data-user-id");A.toCmtId=qing.dom.getAttr(z,"data-cmt-id");A.toReplyeeName=u;A.toUrl=qing.dom.getAttr(B,"href");A.toUserId=qing.dom.getAttr(B,"data-user-id");var E=y.value.length;if(typeof(y.selectionStart)=="undefined"){var s=y.createTextRange();s.moveStart("character",E);s.collapse(true);s.select()}else{y.selectionStart=y.selectionEnd=E;y.focus()}};var a=function(v,t){var s=this;qing.event.preventDefault(v);var r=qing.dom.query(".qcmt-textarea-box",t.elem)[0];var u=r.value;if(t.toReplyeeId){if(u.indexOf("回")==0){u=u.replace("回复 "+t.toReplyeeName+"：","")}else{t.toReplyeeId=""}}if(u.length==0){qui.showAlert("请输入评论");return}if(qing.string.getByteLength(u)>1000){qui.showAlert("评论字数过多");return}qcmt.cmtRequestMgr.cmtAdd({thread_id_enc:t.threadId,content:u,parent_id_enc:t.toCmtId,replyee_portrait:t.toReplyeeId,host_portrait:t.actorPortrait},{onsuccess:function(F){var w="";if(t.toReplyeeId){w=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+t.userInfo.portrait,userName:t.userInfo.userName,userId:t.userInfo.portrait,imgUrl:t.userInfo.avatar,replyeeUrl:t.toUrl,replyeeName:t.toReplyeeName,summary:qing.string.filterFormat.escapeString(u),isWiseIcoShowClass:"hide"})}else{w=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+t.userInfo.portrait,userName:t.userInfo.userName,userId:t.userInfo.portrait,imgUrl:t.userInfo.avatar,summary:qing.string.filterFormat.escapeString(u),isWiseIcoShowClass:"hide"})}if(qcmt.Face&&qcmt.Face.parse){w=qcmt.Face.parse(w)}var x="";if(F&&F[0]&&F[0].replyIdEnc){x=F[0].replyIdEnc}else{return}var z=[];if(t.userInfo.portrait==t.actorPortrait){z.push(qing.string.format(qcmt.tpl.cmtDeleteTpl,{isHoverShowClass:"delete-hover-show"}))}var A=qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+"/go/check?portrait="+t.userInfo.portrait,userId:t.userInfo.portrait,userName:t.userInfo.userName,imgUrl:t.userInfo.avatar,cmtDetailTpl:w,cmtId:x,cmtPubTime:qing.date.format(new Date(F[0].cdatetime*1000),"yyyy-MM-dd HH:mm"),controlBoxTpl:z.join("")});var H=qing.dom.query(".cmt-list",t.elem)[0];qing.dom.insertHTML(H,"afterBegin",A);var C=qing.dom.query(".cmt-item",H)[0];var B=C.offsetHeight;qing.dom.setStyles(C,{height:"0px",overflow:"hidden"});if(qing.browser.ie==6){var E=qing.dom.q("cmt-item-portrait",C)[0];if(E){qing.dom.hide(E)}}var D=qani.animate(C,{height:B+"px"},200);D.on("finish",function(){qing.dom.setStyles(C,{height:"auto",overflow:"visible"});if(qing.browser.ie==6){setTimeout(function(){var J=qing.dom.q("cmt-item-portrait",C)[0];if(J){qing.dom.show(J)}},10)}});t.toReplyeeId="";t.toCmtId="";t.toReplyeeName="";r.value="";r.focus();if(t.numElem){var I=/(\d+)/.exec(t.numElem.innerHTML);var y=qing.dom.getAttr(t.numElem,"data-prefix"),G=qing.dom.getAttr(t.numElem,"data-suffix");if(y===null){y="("}if(G===null){G=")"}if(I&&I[1]){t.numElem.innerHTML=y+(parseInt(I[1])+1)+G}else{t.numElem.innerHTML=y+"1"+G}qing.dom.hasClass(t.numElem,"hide")&&qing.dom.removeClass(t.numElem,"hide");t.numElem.style.display=""}}})};var d=function(t,s){qing.event.preventDefault(t);var r=this;var u=new qui.tip.Tip({target:r,anchor:"top",msg:'<div style="text-align:center;width:160px;color:#999;">确认删除这条评论吗?</div>',buttons:[{text:"确定",type:"green",handler:function(){var x=s.threadId;var w=qext.fn.getAncestorByClass(r,"cmt-item");var v=qing.dom.getAttr(w,"data-cmt-id");qcmt.cmtRequestMgr.cmtDelete({thread_id_enc:x,reply_id_enc:v},{onsuccess:function(A){qui.showSuccess("删除成功");w.style.display="none";if(s.numElem){var y=/(\d+)/.exec(s.numElem.innerHTML);if(y&&y[1]){var B=parseInt(y[1])-1;var C=qing.dom.getAttr(s.numElem,"data-prefix"),z=qing.dom.getAttr(s.numElem,"data-suffix");if(C===null){C="("}if(z===null){z=")"}s.numElem.innerHTML=C+B+z;if(!B){s.numElem.style.display="none"}else{qing.dom.hasClass(s.numElem,"hide")&&qing.dom.removeClass(s.numElem,"hide");s.numElem.style.display=""}}else{s.numElem.style.display="none"}}}});u.close()}},{text:"取消",type:"silver",handler:function(){u.close()}}]});u.show()};var i=function(t,r){var s=qDomain.qing+"/anti/submit/report";qing.ajax.request(s,{method:"POST",data:{reporter_id:r.erId||"",reportee_id:r.eeId||"",type:r.type||"1",reason:r.reason||"1",item_id:r.itemId||"",blog_id:r.blogId||"",content:r.content||"",url:r.url||qUserInfo.qingUrl},onsuccess:t||function(){}})};var m=function(t){t.close();var s;var r=['<div class="mod-report-confirm">',"<p>您的举报已受理，感谢您对百度空间的支持！</p>","<p>我们的员工会尽快处理您的举报</p>"].join("");var u={title:"举报违规行为",opacity:0.2,width:410,height:90,content:r,buttons:[{text:"确定",type:"green",handler:function(){s.close()}}]};s=new qui.dialog.Dialog(u);s.show({isAutoHide:false})};var q=function(A,w){var C;var v=qext.fn.getAncestorByClass(this,"cmt-item");if(v){var r=true;if(qing.dom.query(".cmt-user-name",v)[0]){r=false}var D=qing.dom.query(".cmt-item-portrait img",v)[0].src;var s="";if(r){var E=qing.dom.query(".cmt-replyer-name",v)[0].innerHTML;var B=qing.dom.query(".cmt-summary",v)[0].childNodes;for(var x=0,u=B.length;x<u;x++){var t=B[x];if(t.nodeType===3||t.nodeType===4){s=t.nodeValue;break}}}else{var E=qing.dom.query(".cmt-user-name",v)[0].innerHTML;var B=qing.dom.query(".cmt-content-detail",v)[0].childNodes;for(var x=0,u=B.length;x<u;x++){var t=B[x];if(t.nodeType===3||t.nodeType===4){s=t.nodeValue;break}}}}var z=['<div class="mod-report-dialog">',"<p>亲爱的用户：欢迎使用百度空间举报系统，","您的举报信息我们将在取证后处理，","感谢您的支持，请不要恶意举报哦！</p>",'<div class="report-highlight">你要举报的是：</div>','<div class="report-capture clearfix">','<div class="left avatar"><img src="'+D+'"></div>','<div class="left">','<div class="uname">'+E+"</div>",'<div class="content" >'+s+"</div>","</div>","</div>",'<p class="report-highlight">举报类型：</p>','<form id="reportTypeForm">','<ul class="clearfix">',"<li>",'<input type="radio" name="report_type" id="report_type1" value="1" />&nbsp;','<label for="report_type1">垃圾广告</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type2" value="2" />&nbsp;','<label for="report_type2">淫秽色情</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type3" value="3" />&nbsp;','<label for="report_type3">敏感信息</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type4" value="4" />&nbsp;','<label for="report_type4">人身攻击</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type5" value="5" />&nbsp;','<label for="report_type5">骚扰他人</label>',"</li>","<li>",'<input type="radio" name="report_type" id="report_type6" value="6" />&nbsp;','<label for="report_type6">其他</label>',"</li>","</ul>","</form>",'<p class="red-tip hide">请选择举报类型~</p>',"</div>"].join("");var y={title:"举报违规行为",opacity:0.2,width:410,height:230,content:z,buttons:[{text:"确定",type:"green",handler:function(){var I=qing.dom.getAttr(qing.dom.query(".cmt-item-portrait",v)[0],"data-user-id");var G="0";var F=qing.dom.query("#reportTypeForm input:checked")[0];reportReason=F?F.value:"0";var H=qing.dom.getAttr(v,"data-cmt-id");if(reportReason!=0){i(function(){m(C)},{erId:qVisitorInfo.portrait,eeId:I,type:G,reason:reportReason,itemId:H,blogId:w.threadId,url:qUserInfo.qingUrl,content:s});C.close()}if(reportReason==0){var J=qing.dom.query(".mod-report-dialog .red-tip")[0];qing.removeClass(J,"hide");setTimeout(function(){qing.addClass(J,"hide")},5000)}}},{text:"取消",handler:function(){C.close()}}]};C=new qui.dialog.Dialog(y);C.show({isAutoHide:false})};var k=function(u,t){qing.event.preventDefault(u);var s=this;var r=qing.dom.query(".seemore-loading",t.elem)[0];(qing.dom.hasClass(r,"hide"))&&qing.dom.removeClass(r,"hide");qcmt.cmtRequestMgr.cmtList({thread_id_enc:t.threadId,count:t.count,start:t.nowPage*t.count},{onsuccess:function(y){var y=y[0];var w=y.total_count;var A=y.items;var x=A.length;var z=[];t.nowPage+=1;if(x<t.count){s.style.display="none";qing.dom.query(".qcmt-vl",t.elem)[0].style.display="none"}else{if((t.nowPage*t.count)>t.max){qing.dom.removeClass(s,"cmt-seenext")}}qing.array.each(A,function(D,C){var E="";if(D.replyee_portrait){E=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+D.qurl,userName:D.un,userId:D.portrait,imgUrl:D.avatar,replyeeUrl:qDomain.qing+D.replyee_qurl,replyeeName:D.replyee_name,summary:D.content,isWiseIcoShowClass:D.reserved1&&parseInt(D.reserved1)==1?"":"hide"})}else{E=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+D.qurl,userName:D.un,userId:D.portrait,imgUrl:D.avatar,summary:D.content,isWiseIcoShowClass:D.reserved1&&parseInt(D.reserved1)==1?"":"hide"})}var F=F;var B=[];if(t.userInfo.portrait!=D.portrait){B.push(qcmt.tpl.cmtReportTpl)}if(t.userInfo.portrait==t.actorPortrait){B.push(qing.string.format(qcmt.tpl.cmtDeleteTpl,{isHoverShowClass:"delete-hover-show"}))}if(t.userInfo.portrait!=D.portrait){B.push(qing.string.format(qcmt.tpl.cmtReplyTpl,{isReplyHideClass:""}))}if(qcmt.Face&&qcmt.Face.parse){E=qcmt.Face.parse(E)}z.push(qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+D.qurl,userName:D.un,imgUrl:D.avatar,cmtDetailTpl:E,cmtId:D.reply_id_enc,threadId:t.threadId,userId:D.portrait,cmtPubTime:qing.date.format(new Date(D.cdatetime*1000),"yyyy-MM-dd HH:mm"),controlBoxTpl:B.join("")}))});var v=qing.dom.query(".cmt-list",t.elem)[0];qing.dom.insertHTML(v,"beforeEnd",z.join(""));(!qing.dom.hasClass(r,"hide"))&&qing.dom.addClass(r,"hide")}})};var n=function(x,u){qing.event.preventDefault(x);if(u.elem.cmtCreating||u.elem.cmtCrashing){return}u.elem.cmtCrashing=true;var w=u.target;var t=qing.dom.getPosition(u.elem).top-100;var y=T.browser.isWebkit?document.body:document.documentElement;var v=y.scrollTop;if(v>t){var s=t<0?0:t;y.scrollTop=s}u.elem.style.overflow="hidden";var r=qani.animate(u.elem,{height:u.elem.offsetHeight+"px$tween:strongAccelerate"},{height:0},300);r.on("finish",function(){u.elem.style.display="none";u.elem.style.overflow="visible";u.elem.style.height="0";u.elem.cmtCrashing=false;u.destroyCallback&&u.destroyCallback()});u.elem.targetElem=null};var h=function(s,r){qing.event.preventDefault(s);if(qVisitorInfo.loginStatus!="activated"){return}var t=qing.dom.query(".cmt-report",this)[0];if(t){qing.removeClass(t,"hide")}if(r.userInfo.portrait==r.actorPortrait){qing.dom.addClass(this,"mouseover")}};var c=function(s,r){qing.event.preventDefault(s);if(qVisitorInfo.loginStatus!="activated"){return}var t=qing.dom.query(".cmt-report",this)[0];if(t){qing.addClass(qing.dom.query(".cmt-report",this)[0],"hide")}if(r.userInfo.portrait==r.actorPortrait){qing.dom.removeClass(this,"mouseover")}};var l=function(t,r){var s=t.which||t.keyCode;if(t.ctrlKey&&s==13){a.call(this,t,r)}};var e=function(s,r){var t=qing.dom.query(".qcmt-textarea-wraper",r.elem)[0];qing.dom.addClass(t,"focus")};var p=function(s,r){var t=qing.dom.query(".qcmt-textarea-wraper",r.elem)[0];qing.dom.removeClass(t,"focus")};var o=function(s,r){qing.dom.addClass(this,"mouseover")};var b=function(s,r){qing.dom.removeClass(this,"mouseover")};var f=function(s,r){qing.event.stop(s);return false};var j={click:{"cmt-reply":g,"cmt-add":a,"cmt-delete":d,"cmt-report":q,"cmt-seenext":k,"qcmt-collapse":n},mouseover:{"cmt-item":h,"qcmt-textarea-wraper":o},mouseout:{"cmt-item":c,"qcmt-textarea-wraper":b},focus:{"qcmt-textarea-box":e},blur:{"qcmt-textarea-box":p},keyup:{"qcmt-textarea-box":l}};return qing.lang.createClass(function(s,r){this.engineListenObj=j;this.nowPage=0;this.count=r.count;this.toReplyeeId="";this.toCmtId="";this.toReplyeeName="";this.max=r.max},{superClass:qcmt.Base}).extend({format:function(){var s=this;var w=qing.string.format(qcmt.tpl.wraper,{cmtWraperId:s.cmtWraperId,arrowLeft:qing.dom.getPosition(s.target).left-qing.dom.getPosition(s.elem).left+5,cmtListContent:"",footer:""});s.elem.style.height=s.elem.offsetHeight+"px";s.elem.style.overflow="hidden";s.elem.innerHTML=w;var r=qing.dom.query(".qcmt-textarea-box",s.elem)[0];var v=qing.dom.query(".qcmt-input-textnum-tip",s.elem)[0];var u=qing.dom.query(".now-num",v)[0];qext.textarea({autoHeight:true,element:r,autoRender:true,gbkMaxSize:500,callback:function(z){var y=Math.ceil(z/2);if(y>400){u.innerHTML=Math.ceil(z/2);v.style.display="block";if(y>=500){u.style.color="#F46E6E"}else{u.style.color="#999"}}else{v.style.display="none"}}});function x(D){D&&(D=D[0]);var F=D.total_count;var G=D.items;var H=G.length;var A=[];s.nowPage+=1;qing.array.each(G,function(O,N){var P="";if(O.replyee_portrait){P=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+O.qurl,userName:O.un,userId:O.portrait,imgUrl:O.avatar,replyeeUrl:qDomain.qing+O.replyee_qurl,replyeeName:O.replyee_name,summary:O.content,isWiseIcoShowClass:O.reserved1&&parseInt(O.reserved1)==1?"":"hide"})}else{P=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+O.qurl,userName:O.un,userId:O.portrait,imgUrl:O.avatar,summary:O.content,isWiseIcoShowClass:O.reserved1&&parseInt(O.reserved1)==1?"":"hide"})}var Q=Q;var L=[];if(s.userInfo.portrait!=O.portrait){L.push(qcmt.tpl.cmtReportTpl)}if(s.userInfo.portrait==s.actorPortrait){L.push(qing.string.format(qcmt.tpl.cmtDeleteTpl,{isHoverShowClass:"delete-hover-show"}))}if(s.userInfo.portrait!=O.portrait){L.push(qing.string.format(qcmt.tpl.cmtReplyTpl,{isReplyHideClass:""}))}var M=qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+O.qurl,userName:O.un,imgUrl:O.avatar,cmtDetailTpl:P,cmtId:O.reply_id_enc,threadId:s.threadId,userId:O.portrait,cmtPubTime:qing.date.format(new Date(O.cdatetime*1000),"yyyy-MM-dd HH:mm"),controlBoxTpl:L.join("")});if(qcmt.Face&&qcmt.Face.parse){M=qcmt.Face.parse(M)}A.push(M)});var K=qing.string.format(qcmt.tpl.cmtFooter,{isSeemoreHideClass:(G.length==0||G.length<s.count)?"hide":"",seemoreUrl:qDomain.qing+s.actorQingUrl+"/item/"+s.threadId+"#reply"});var E=qing.string.format(qcmt.tpl.cmtList,{cmtList:A.join("")});var I=qing.dom.query(".qcmt-list-wraper",s.elem)[0];var B=qing.dom.query(".qcmt-footer-wraper",s.elem)[0];I.innerHTML=E;B.innerHTML=K;var y=qing.g(s.cmtWraperId);var C=qani.animate(s.elem,{height:y.offsetHeight},400);C.on("finish",function(){s.elem.style.overflow="visible";s.elem.style.height="auto";var N=qing.dom.query(".qcmt-textarea-box",s.elem)[0];if(s.focus){N.focus()}s.callback&&s.callback();s.elem.cmtCreating=false;if(qing.browser.ie==6){var M=qing.dom.q("cmt-item-portrait",s.elem);if(M.length){for(var O=0,L=M.length;O<L;O++){qing.dom.hide(M[O]);qing.dom.show(M[O])}}}});if(s.numElem){if(F&&F!="0"){var z=qing.dom.getAttr(s.numElem,"data-prefix"),J=qing.dom.getAttr(s.numElem,"data-suffix");if(z===null){z="("}if(J===null){J=")"}s.numElem.innerHTML=z+F+J;qing.dom.hasClass(s.numElem,"hide")&&qing.dom.removeClass(s.numElem,"hide")}else{(!qing.dom.hasClass(s.numElem,"hide"))&&qing.dom.addClass(s.numElem,"hide")}}}function t(y){var y=[{total_count:"0",real_ret_count:"",items:[]}];x(y)}qcmt.Face&&qcmt.Face.init&&qcmt.Face.init(qing.q("qcmt-input-textarea-box",s.elem)[0]);qcmt.cmtRequestMgr.cmtList({thread_id_enc:s.threadId,count:s.count},{onsuccess:x,onerror:t,onfailure:t,onexception:t,ontimeout:t})}})})();qing.registNS("qcmt");qcmt.Tag=(function(){var h=function(q,r,p){if(q){q.innerHTML=r||""}p&&qing.dom.addClass(p,"cmt-tip-warning")};var i=function(q,p){if(q){q.innerHTML=""}p&&qing.dom.removeClass(p,"cmt-tip-warning")};var b=function(v,r){qing.event.preventDefault(v);if(r.elem.cmtCreating||r.elem.cmtCrashing){return}var w=qing.dom.query(".qcmt-input-repost-checkbox",r.elem)[0];var x=qing.dom.query(".qcmt-textarea-wraper",r.elem)[0];i(w,x);var p=qing.dom.query(".qcmt-inner-tag-name",r.elem)||[];var u=p.length;var y=qing.dom.query(".qcmt-textarea-box",r.elem)[0];if(u<1){qui.showAlert("请输入标签");return}var s=[];for(var t=0;t<u;t++){var q=qing.dom.getAttr(p[t],"title");q=qing.string.trim(q);s.push(qing.string.decodeHTML(q))}r.elem.cmtCrashing=true;qing.ajax.request(qDomain.qing+"/pub/submit/addtag",{method:"post",data:{portrait:qUserInfo.portrait,qbid:r.threadId,"tags[]":s.reverse()},onsuccess:function(){qui.showSuccess("添加标签成功");qing.dom.query(".qcmt-tag-box",r.elem)[0].innerHTML="";var G=qing.dom.getAncestorByClass(r.cmtWraperId,"feed-detail-info-box");var B=qing.dom.query(".feed-tag-box",G)[0];var F=s.reverse();var E=['<span class="t-tag-label hide">标签：</span>'];for(var D=0,A=F.length;D<A;D++){var C=qDomain.qing+"/tag/"+F[D]+"/feeds";E.push('<a class="t-tag" href="'+C+'" target="_blank">#'+qing.string.encodeHTML(F[D])+"</a>")}B.innerHTML=E.join("");r.elem.style.overflow="hidden";var z=qani.animate(r.elem,{height:r.elem.offsetHeight+"px$tween:strongAccelerate"},{height:0},300);z.on("finish",function(){r.elem.style.display="none";r.elem.style.overflow="visible";r.elem.style.height="0";r.elem.cmtCrashing=false;r.destroyCallback&&r.destroyCallback()});r.elem.targetElem=null},onerror:function(z){if(r&&r.elem){r.elem.cmtCrashing=false}if(parseInt(z.errorNo,10)==102||parseInt(z.errorNo,10)==600){return}qui.showError(z.errorMsg)},onfailure:function(z){if(r&&r.elem){r.elem.cmtCrashing=false}}})};var d=true;var l=function(r,p){var q=r.which||r.keyCode;var s=qing.string.trim(this.value);if(!r.shiftKey&&s!=""&&(q==13||q==188)){k(s,p.elem)}else{if(q==8){d=true}}};var e=function(t,r){var s=t.which||t.keyCode;var u=qing.string.trim(this.value);if(d===true&&s==8&&u==""){var q=qing.Q("qcmt-inner-tag-wrapper",r.elem,"div");var p=q.length;if(p>0){qing.dom.remove(q[p-1])}}d=false};var g=function(q,p){var r=qing.dom.query(".qcmt-textarea-wraper",p.elem)[0];qing.dom.addClass(r,"focus")};var n=function(q,p){var s=qing.dom.query(".qcmt-textarea-wraper",p.elem)[0];qing.dom.removeClass(s,"focus");var r=qing.string.trim(this.value);if(r!=""){k(r,p.elem)}};var a=function(s,p){var r=qing.dom.query(".qcmt-input-repost-checkbox",p.elem)[0];var q=qing.dom.query(".qcmt-textarea-wraper",p.elem)[0];i(r,q)};var m=function(q,p){qing.dom.addClass(this,"mouseover")};var c=function(q,p){qing.dom.removeClass(this,"mouseover")};var o=function(q,p){var r=qing.string.trim(this.value);if(r!=""){k(r,p.elem)}};var f=function(s,p){qing.event.preventDefault(s);var r=this;var q=r.innerHTML;k(q,p.elem)};var j={click:{"cmt-add":b,"qcmt-textarea-box":o,"qcmt-textarea-wraper":a,"cmt-tag-item":f},keyup:{"qcmt-textarea-box":l},keydown:{"qcmt-textarea-box":e},mouseover:{"qcmt-textarea-wraper":m},mouseout:{"qcmt-textarea-wraper":c},focus:{"qcmt-textarea-box":g,"qcmt-textarea-wraper":a},blur:{"qcmt-textarea-box":n}};var k=function(q,t){var A=qing.dom.query(".qcmt-input-repost-checkbox",t)[0];var B=qing.dom.query(".qcmt-textarea-wraper",t)[0];var C=qing.dom.query(".qcmt-textarea-box",t)[0];i(A,B);var p=qing.dom.query(".qcmt-tag-box",t)[0];var r=qing.dom.query(".qcmt-inner-tag-name",t)||[];var y=r.length;if(y>9){h(A,"最多10个标签",B);C.value="";return}var u=qing.string.trim(q);var s=new RegExp("["+[",","，","，"].join("")+"]","g");u=u.replace(s,"");if(u==""){C.value="";return}if(Math.ceil(qing.string.getByteLength(u)/2)>10){h(A,"单个标签最多10字",B);return}for(var x=0;x<y;x++){var w=qing.dom.getAttr(r[x],"title");if(w==u){h(A,"此标签已存在",B);return}}var v=document.createElement("div");qing.dom.addClass(v,"qcmt-inner-tag-wrapper");p.appendChild(v);v.innerHTML=qing.string.format(qcmt.tpl.innerTag,{tagName:u});var z=qing.dom.query(".qcmt-inner-tag-close",v)[0];qing.event.on(z,"click",function(D){qing.event.preventDefault(D);qing.dom.remove(v)});C.value=""};return qing.lang.createClass(function(){this.engineListenObj=j},{superClass:qcmt.Base}).extend({format:function(){var r=this;var t=qing.string.format(qcmt.tpl.wraper,{cmtWraperId:r.cmtWraperId,qcmtAddTagWrapper:"qcmt-add-tag-wrapper",arrowLeft:qing.dom.getPosition(r.target).left-qing.dom.getPosition(r.elem).left+20,cmtListContent:"",footer:"",friendName:"",authorName:"",checkIndex:qing.lang.guid()});qing.ajax.get(qDomain.qing+"/pub/data/gettaglist",{portrait:qUserInfo.portrait},function(A){var F=A[0].qTagList;var y=A[0].qHotTagList;var u=[];var C=[];var E="hide";var B="hide";var D;if(F.length!=0){E="";for(var z=0,x=Math.min(F.length,24);z<x;z++){D=qing.string.format(qcmt.tpl.cmtTagItemTpl,{tagName:F[z]});u.push(D)}}if(y.length!=0){B="";for(var z=0,w=Math.min(y.length,24);z<w;z++){D=qing.string.format(qcmt.tpl.cmtTagItemTpl,{tagName:y[z]});C.push(D)}}var v=qing.string.format(qcmt.tpl.cmtAddTagTpl,{tagWrap:E,tagLists:u.join(""),hotTagWrap:B,hotTagLists:C.join("")});qing.dom.query(".qcmt-list-wraper",r.elem)[0].innerHTML=v});r.elem.style.overflow="hidden";r.elem.style.height=r.elem.offsetHeight+"px";r.elem.innerHTML=t;var s=qing.g(r.cmtWraperId);var p=qani.animate(r.elem,{height:s.offsetHeight},300);p.on("finish",function(){r.elem.style.overflow="visible";r.elem.style.height="auto";var u=qing.dom.query(".qcmt-textarea-box",r.elem)[0];if(r.focus){u.focus()}r.callback&&r.callback();r.elem.cmtCreating=false});var q=qing.dom.query(".qcmt-textarea-box",r.elem)[0];qext.textarea({autoHeight:false,element:q,autoRender:true,gbkMaxSize:500,callback:function(u){}})}})})();qing.registNS("qcmt");qcmt.build=(function(){var b={};var a=false;return function(e,g,c){if(e.cmtCreating||e.cmtCrashing){return}if(e.targetElem&&g.target==e.targetElem){return null}e.cmtCreating=true;var j=qVisitorInfo;j.avatar=qVisitorAvatar.size20;var m={userInfo:j,target:g.target,numElem:g.numElem,extraNumElem:g.extraNumElem||null,type:g.type||"comment",threadId:g.id,actorPortrait:g.actorPortrait,actorName:g.actorName,actorQingUrl:g.actorQingUrl,count:g.count||10,max:g.max||200,callback:g.callback,focus:(typeof g.focus=="undefined")?true:g.focus,bindTargetEvent:(typeof g.bindTargetEvent=="undefined")?true:g.bindTargetEvent,cmtWraperId:"qcmt"+parseInt((Math.random()+1)*1000000),contentType:g.contentType||"text",originAuthor:g.originAuthor||null,originThreadId:g.originThreadId||"",repostSuccess:g.repostSuccess,destroyCallback:g.destroyCallback};var f;if(m.type=="repost"){f=new qcmt.Repost(e,m)}else{if(m.type=="comment"){f=new qcmt.Comment(e,m)}else{f=new qcmt.Tag(e,m)}}if(!a){if(c){for(var l in c){if(b[l]){var d=c[l];var k=b[l];for(var h in d){k[h]=d[h]}}else{b[l]=c[l]}}}qext.stylesheet(b);a=true}e.style.display="block";f.format();f.engineListen();if(!e.targetElem){e.targetElem=m.target}var i=function(n){if(e.cmtCreating||e.cmtCrashing){return}if(e.targetElem&&m.target==e.targetElem){e.cmtCrashing=true;setTimeout(function(){var r=m.target;m.bindTargetEvent&&qing.event.un(m.target,"click",i);e.targetElem=null;e.style.overflow="hidden";if(qing.browser.ie==6){var q=qing.dom.q("cmt-item-portrait",e);if(q.length){for(var s=0,p=q.length;s<p;s++){qing.dom.hide(q[s])}}}var o=qani.animate(e,{height:e.offsetHeight+"px$tween:strongAccelerate"},{height:0},300);o.on("finish",function(){e.style.display="none";e.style.overflow="visible";e.style.height="0";e.cmtCrashing=false;m.destroyCallback&&m.destroyCallback()})},0)}};m.bindTargetEvent&&qing.event.on(m.target,"click",i);e.targetElem=m.target;return{destroy:function(){i()}}}})();